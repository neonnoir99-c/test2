/**
 * Visual Sync Styles
 * Optimized CSS for smooth, lag-free visual feedback
 * Uses GPU-accelerated transforms and efficient animations
 */

/* ============================================
   BASE GRID CELL STYLES
   ============================================ */

.grid-cell {
  position: relative;
  transition: transform 0.05s ease-out;
  /* Use will-change sparingly - only for frequently animated properties */
  will-change: transform;
  /* Enable GPU acceleration */
  transform: translateZ(0);
  backface-visibility: hidden;
  -webkit-font-smoothing: subpixel-antialiased;
}

/* Beat markers (every 4 steps) */
.grid-cell.beat-marker {
  border-left: 2px solid rgba(255, 255, 255, 0.3);
}

.grid-cell.beat-marker:first-child {
  border-left: 3px solid rgba(255, 255, 255, 0.5);
}

/* Active notes (when programmed in pattern) */
.grid-cell.note-active {
  box-shadow: inset 0 0 8px rgba(255, 255, 255, 0.3);
}

/* ============================================
   HIGHLIGHT MODE - Clean border highlight
   ============================================ */

.step-playing-highlight {
  border: 3px solid rgba(255, 255, 255, 0.9) !important;
  box-shadow: 
    0 0 10px rgba(255, 255, 255, 0.5),
    inset 0 0 10px rgba(255, 255, 255, 0.2);
  transform: scale(1.05) translateZ(0);
  z-index: 10;
}

/* Track-specific highlight colors */
.kick-playing.step-playing-highlight {
  border-color: rgba(239, 68, 68, 0.9) !important;
  box-shadow: 
    0 0 15px rgba(239, 68, 68, 0.6),
    inset 0 0 10px rgba(239, 68, 68, 0.2);
}

.snare-playing.step-playing-highlight {
  border-color: rgba(20, 184, 166, 0.9) !important;
  box-shadow: 
    0 0 15px rgba(20, 184, 166, 0.6),
    inset 0 0 10px rgba(20, 184, 166, 0.2);
}

.hihat-playing.step-playing-highlight {
  border-color: rgba(234, 179, 8, 0.9) !important;
  box-shadow: 
    0 0 15px rgba(234, 179, 8, 0.6),
    inset 0 0 10px rgba(234, 179, 8, 0.2);
}

.bass-playing.step-playing-highlight {
  border-color: rgba(96, 165, 250, 0.9) !important;
  box-shadow: 
    0 0 15px rgba(96, 165, 250, 0.6),
    inset 0 0 10px rgba(96, 165, 250, 0.2);
}

/* ============================================
   PULSE MODE - Rhythmic scaling animation
   ============================================ */

.step-playing-pulse {
  animation: pulse-beat 0.125s ease-out;
  border: 2px solid rgba(255, 255, 255, 0.8);
  z-index: 10;
}

@keyframes pulse-beat {
  0% {
    transform: scale(1) translateZ(0);
    box-shadow: 0 0 0 rgba(255, 255, 255, 0);
  }
  50% {
    transform: scale(1.15) translateZ(0);
    box-shadow: 0 0 20px rgba(255, 255, 255, 0.6);
  }
  100% {
    transform: scale(1.05) translateZ(0);
    box-shadow: 0 0 10px rgba(255, 255, 255, 0.3);
  }
}

/* Track-specific pulse colors */
.kick-playing.step-playing-pulse {
  animation: pulse-beat-kick 0.125s ease-out;
}

@keyframes pulse-beat-kick {
  0% {
    transform: scale(1) translateZ(0);
    box-shadow: 0 0 0 rgba(239, 68, 68, 0);
  }
  50% {
    transform: scale(1.15) translateZ(0);
    box-shadow: 0 0 25px rgba(239, 68, 68, 0.8);
  }
  100% {
    transform: scale(1.05) translateZ(0);
    box-shadow: 0 0 15px rgba(239, 68, 68, 0.4);
  }
}

.snare-playing.step-playing-pulse {
  animation: pulse-beat-snare 0.125s ease-out;
}

@keyframes pulse-beat-snare {
  0% {
    transform: scale(1) translateZ(0);
    box-shadow: 0 0 0 rgba(20, 184, 166, 0);
  }
  50% {
    transform: scale(1.15) translateZ(0);
    box-shadow: 0 0 25px rgba(20, 184, 166, 0.8);
  }
  100% {
    transform: scale(1.05) translateZ(0);
    box-shadow: 0 0 15px rgba(20, 184, 166, 0.4);
  }
}

.hihat-playing.step-playing-pulse {
  animation: pulse-beat-hihat 0.125s ease-out;
}

@keyframes pulse-beat-hihat {
  0% {
    transform: scale(1) translateZ(0);
    box-shadow: 0 0 0 rgba(234, 179, 8, 0);
  }
  50% {
    transform: scale(1.15) translateZ(0);
    box-shadow: 0 0 25px rgba(234, 179, 8, 0.8);
  }
  100% {
    transform: scale(1.05) translateZ(0);
    box-shadow: 0 0 15px rgba(234, 179, 8, 0.4);
  }
}

.bass-playing.step-playing-pulse {
  animation: pulse-beat-bass 0.125s ease-out;
}

@keyframes pulse-beat-bass {
  0% {
    transform: scale(1) translateZ(0);
    box-shadow: 0 0 0 rgba(96, 165, 250, 0);
  }
  50% {
    transform: scale(1.15) translateZ(0);
    box-shadow: 0 0 25px rgba(96, 165, 250, 0.8);
  }
  100% {
    transform: scale(1.05) translateZ(0);
    box-shadow: 0 0 15px rgba(96, 165, 250, 0.4);
  }
}

/* ============================================
   GLOW MODE - Intense glow effect
   ============================================ */

.step-playing-glow {
  animation: glow-fade 0.125s ease-out;
  z-index: 10;
}

@keyframes glow-fade {
  0% {
    box-shadow: 0 0 0 rgba(255, 255, 255, 0);
    filter: brightness(1);
  }
  30% {
    box-shadow: 
      0 0 30px rgba(255, 255, 255, 0.9),
      inset 0 0 20px rgba(255, 255, 255, 0.5);
    filter: brightness(1.5);
  }
  100% {
    box-shadow: 
      0 0 15px rgba(255, 255, 255, 0.5),
      inset 0 0 10px rgba(255, 255, 255, 0.3);
    filter: brightness(1.2);
  }
}

/* Track-specific glow */
.kick-playing.step-playing-glow {
  animation: glow-fade-kick 0.125s ease-out;
}

@keyframes glow-fade-kick {
  0% {
    box-shadow: 0 0 0 rgba(239, 68, 68, 0);
  }
  30% {
    box-shadow: 
      0 0 40px rgba(239, 68, 68, 1),
      inset 0 0 25px rgba(239, 68, 68, 0.6);
  }
  100% {
    box-shadow: 
      0 0 20px rgba(239, 68, 68, 0.6),
      inset 0 0 15px rgba(239, 68, 68, 0.3);
  }
}

.snare-playing.step-playing-glow {
  animation: glow-fade-snare 0.125s ease-out;
}

@keyframes glow-fade-snare {
  0% {
    box-shadow: 0 0 0 rgba(20, 184, 166, 0);
  }
  30% {
    box-shadow: 
      0 0 40px rgba(20, 184, 166, 1),
      inset 0 0 25px rgba(20, 184, 166, 0.6);
  }
  100% {
    box-shadow: 
      0 0 20px rgba(20, 184, 166, 0.6),
      inset 0 0 15px rgba(20, 184, 166, 0.3);
  }
}

.hihat-playing.step-playing-glow {
  animation: glow-fade-hihat 0.125s ease-out;
}

@keyframes glow-fade-hihat {
  0% {
    box-shadow: 0 0 0 rgba(234, 179, 8, 0);
  }
  30% {
    box-shadow: 
      0 0 40px rgba(234, 179, 8, 1),
      inset 0 0 25px rgba(234, 179, 8, 0.6);
  }
  100% {
    box-shadow: 
      0 0 20px rgba(234, 179, 8, 0.6),
      inset 0 0 15px rgba(234, 179, 8, 0.3);
  }
}

.bass-playing.step-playing-glow {
  animation: glow-fade-bass 0.125s ease-out;
}

@keyframes glow-fade-bass {
  0% {
    box-shadow: 0 0 0 rgba(96, 165, 250, 0);
  }
  30% {
    box-shadow: 
      0 0 40px rgba(96, 165, 250, 1),
      inset 0 0 25px rgba(96, 165, 250, 0.6);
  }
  100% {
    box-shadow: 
      0 0 20px rgba(96, 165, 250, 0.6),
      inset 0 0 15px rgba(96, 165, 250, 0.3);
  }
}

/* ============================================
   MINIMAL MODE - Subtle indicator
   ============================================ */

.step-playing-minimal {
  border-bottom: 4px solid rgba(255, 255, 255, 0.9);
  transform: translateY(-2px) translateZ(0);
  z-index: 10;
}

.kick-playing.step-playing-minimal {
  border-bottom-color: rgba(239, 68, 68, 0.9);
}

.snare-playing.step-playing-minimal {
  border-bottom-color: rgba(20, 184, 166, 0.9);
}

.hihat-playing.step-playing-minimal {
  border-bottom-color: rgba(234, 179, 8, 0.9);
}

.bass-playing.step-playing-minimal {
  border-bottom-color: rgba(96, 165, 250, 0.9);
}

/* ============================================
   ACTIVE NOTE PLAYING - Extra emphasis
   ============================================ */

.note-active-playing {
  filter: brightness(1.3) saturate(1.2);
}

/* ============================================
   PERFORMANCE OPTIMIZATIONS
   ============================================ */

/* Reduce motion for accessibility and performance */
@media (prefers-reduced-motion: reduce) {
  .grid-cell,
  .step-playing-pulse,
  .step-playing-glow {
    animation: none !important;
    transition: none !important;
  }
  
  .step-playing-highlight,
  .step-playing-minimal {
    transition: opacity 0.05s ease-out;
  }
}

/* Optimize for lower-end devices */
@media (max-width: 768px) {
  .grid-cell {
    will-change: auto; /* Reduce GPU memory on mobile */
  }
  
  /* Simplify animations on mobile */
  .step-playing-pulse,
  .step-playing-glow {
    animation-duration: 0.1s; /* Faster on mobile */
  }
}

/* ============================================
   ADDITIONAL VISUAL ENHANCEMENTS
   ============================================ */

/* Smooth transition when notes are toggled */
.grid-cell.note-active {
  transition: box-shadow 0.2s ease-out;
}

/* Hover effect doesn't interfere with playback */
.grid-cell:hover:not(.step-playing) {
  transform: scale(1.02) translateZ(0);
  transition: transform 0.1s ease-out;
}

/* Focus state for accessibility */
.grid-cell:focus-visible {
  outline: 2px solid rgba(255, 255, 255, 0.8);
  outline-offset: 2px;
}

/* ============================================
   LOADING STATE
   ============================================ */

.grid-cell.loading {
  opacity: 0.5;
  pointer-events: none;
  animation: pulse-loading 1s ease-in-out infinite;
}

@keyframes pulse-loading {
  0%, 100% {
    opacity: 0.5;
  }
  50% {
    opacity: 0.8;
  }
}

/* ============================================
   DEBUG MODE (optional)
   ============================================ */

.visual-sync-debug .grid-cell {
  position: relative;
}

.visual-sync-debug .grid-cell::after {
  content: attr(data-step);
  position: absolute;
  top: 2px;
  right: 2px;
  font-size: 8px;
  color: rgba(255, 255, 255, 0.3);
  pointer-events: none;
}

.visual-sync-debug .step-playing::before {
  content: 'â–¶';
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  font-size: 20px;
  color: rgba(255, 255, 255, 0.9);
  pointer-events: none;
  z-index: 100;
}
